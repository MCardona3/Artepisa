<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Clientes · Artepisa SLP (Graph)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    /* ====== Layout original de 2 columnas (opcional para futuros usos) ====== */
    main.container { display:block; }
    main.container.split {
      display: grid;
      grid-template-columns: minmax(380px, 1fr) minmax(420px, 1fr);
      gap: 16px;
      align-items: start;
    }
    .card-form { display:none; }
    .split .card-form { display:block; }

    /* ====== NUEVO: Modo SOLO FORMULARIO (oculta la lista y centra el form) ====== */
    main.container.form-only #card-list { display:none; }
    main.container.form-only #card-form {
      display:block;
      grid-column: 1 / -1;
      max-width: 860px;
      margin-inline: auto;
    }

    /* Responsive: si usas split, cae a 1 columna; form-only ya ocupa ancho completo */
    @media (max-width: 980px){
      main.container.split { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body class="theme-light">
  <!-- Guardia de sesión -->
  <script>
    const __acct = JSON.parse(sessionStorage.getItem('artepisa_account')||'null');
    if(!__acct){ location.href = 'index.html'; }
  </script>

  <header class="brand">
    <div class="logo">
      <img class="brandlogo" src="./img/arte.png?v=1" alt="ARTEPISA SLP">
      <div>
        <div class="brandname">ARTEPISA SLP</div>
        <div class="muted">Clientes (OneDrive/SharePoint)</div>
      </div>
    </div>
    <a class="btn ghost" href="dashboard.html">Volver</a>
  </header>

  <!-- Arrancamos SIN split; el JS controla cambiar a form-only cuando haga falta -->
  <main class="container tablewide" id="layout">
    <!-- LISTA -->
    <section class="card" id="card-list">
      <h2 style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <span style="flex:1">Clientes</span>
        <button class="btn" id="btn-show-form" type="button" title="Crear o agregar cliente">Crear / Agregar</button>
      </h2>

      <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
        <input id="c-buscar" class="input" placeholder="Buscar por nombre, dirección, RFC, estado o contacto…" style="flex:1;min-width:240px">
        <button class="btn ghost" id="c-exportar" type="button" title="Exportar JSON">Exportar</button>

        <label class="btn ghost" for="c-importar" title="Importar JSON/CSV/TSV">Importar
          <input id="c-importar" type="file" accept=".json,.csv,.tsv,text/csv,text/tab-separated-values,application/json" style="display:none">
        </label>

        <button class="btn danger" id="c-reset" type="button" title="Borrar todos los clientes">Limpiar</button>
      </div>

      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Dirección</th>
              <th>RFC</th>
              <th>Estado</th>
              <th>Nombre de Contacto</th>
              <th>Teléfono de Contacto</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="c-tabla"></tbody>
        </table>
      </div>
    </section>

    <!-- FORMULARIO -->
    <section class="card card-form" id="card-form">
      <h3>Formulario</h3>
      <div class="form">
        <div class="field">
          <label for="c-id">IDCliente</label>
          <input id="c-id" class="input" placeholder="(auto)" readonly>
          <small class="help">Se conserva el ID del archivo importado; si falta, se genera.</small>
        </div>

        <div class="field">
          <label for="c-nombre">Nombre</label>
          <input id="c-nombre" class="input" placeholder="Razón social o nombre comercial">
        </div>

        <div class="field">
          <label for="c-telefono">Teléfono</label>
          <input id="c-telefono" class="input"
                 inputmode="numeric"
                 autocomplete="tel"
                 maxlength="27"
                 data-phone-mask
                 placeholder="4441234567 o 4441234567/4449876543">
          <small class="help">10 dígitos o 2 teléfonos (20 dígitos) separados por “/”.</small>
        </div>

        <div class="field">
          <label for="c-direccion">Dirección</label>
          <input id="c-direccion" class="input" placeholder="Calle, #, Colonia, Ciudad">
        </div>

        <div class="field">
          <label for="c-rfc">RFC</label>
          <input id="c-rfc" class="input" placeholder="ABC123456XYZ">
        </div>

        <div class="field">
          <label for="c-estado">Estado</label>
          <input id="c-estado" class="input" placeholder="San Luis Potosí">
        </div>

        <div class="field">
          <label for="c-contacto">Nombre de Contacto</label>
          <input id="c-contacto" class="input" placeholder="Persona de contacto">
        </div>

        <div class="field">
          <label for="c-contacto-tel">Teléfono de Contacto</label>
          <input id="c-contacto-tel" class="input"
                 inputmode="numeric"
                 autocomplete="tel"
                 maxlength="27"
                 data-phone-mask
                 placeholder="4441234567 o 4441234567/4449876543">
          <small class="help">10 dígitos o 2 teléfonos (20 dígitos) separados por “/”.</small>
        </div>

        <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <button class="btn" id="c-guardar" type="button">Guardar</button>
          <button class="btn ghost" id="c-nuevo" type="button">Nuevo</button>
          <button class="btn danger" id="c-eliminar" type="button">Eliminar</button>
          <span style="flex:1"></span>
          <button class="btn ghost" id="c-cerrar" type="button" title="Ocultar formulario">Cerrar</button>
        </div>
      </div>
    </section>
  </main>

  <!-- MSAL + módulos (el orden importa) -->
  <script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
  <script src="./js/msal-config.js"></script>
  <script src="./js/auth.js"></script>
  <script src="./js/graph.js"></script>
  <script src="./js/data.js"></script>

  <!-- Lógica de la página -->
  <script src="./js/clientes.js?v=9"></script>
</body>
  <!-- MSAL (autenticación) -->
<script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
<script src="./js/msal-config.js"></script>
<script src="./js/auth.js"></script>

<!-- Protege la página (obliga login) -->
<script>
  (async () => {
    try { await MSALApp.requireAuth(); } catch { location.href = "index.html"; }
  })();
</script>

<!-- Graph y capa de datos -->
<script src="./js/graph.js"></script>
<script src="./js/data.js"></script>

<!-- TU lógica de la página -->
<script src="./js/clientes.js?v=10"></script>

</html>
