<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Clientes · Artepisa SLP (Graph)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/clientes.css" />
  </head>
<body class="theme-light">
  <!-- Guardia de sesión -->
  <script>
    const __acct = JSON.parse(sessionStorage.getItem('artepisa_account') || 'null');
    if (!__acct) location.href = 'index.html';
  </script>

  <header class="brand">
    <div class="logo">
      <img class="brandlogo" src="./img/arte.png?v=1" alt="ARTEPISA SLP" />
      <div>
        <div class="brandname">ARTEPISA SLP</div>
        <div class="muted">Clientes</div>
      </div>
    </div>
    <a class="btn ghost" href="dashboard.html" aria-label="Volver al panel">Volver</a>
  </header>

  <main class="container tablewide" id="layout">
    <!-- LISTA -->
    <section class="card" id="card-list">
      <h2 class="flex-wrap" style="display:flex;align-items:center;gap:8px;">
        <span style="flex:1">Clientes</span>
        <span class="badge" id="c-contador" title="Total de clientes">0</span>
        <button class="btn" id="btn-show-form" type="button" title="Crear o agregar cliente">Crear / Agregar</button>
      </h2>

      <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
        <input id="c-buscar" class="input" placeholder="Buscar por nombre, dirección, RFC, estado o contacto…" style="flex:1;min-width:240px" autocomplete="off" />
        <button class="btn ghost" id="c-exportar" type="button" title="Exportar JSON">Exportar</button>

        <label class="btn ghost" for="c-importar" title="Importar JSON/CSV/TSV">Importar
          <input id="c-importar" type="file" accept=".json,.csv,.tsv,text/csv,application/json" style="display:none" />
        </label>

        <button class="btn danger" id="c-reset" type="button" title="Borrar todos los clientes">Limpiar</button>
      </div>

      <div class="table-wrap">
        <table class="table" aria-label="Lista de clientes">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Dirección</th>
              <th>RFC</th>
              <th>Estado</th>
              <th>Nombre de Contacto</th>
              <th>Teléfono de Contacto</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="c-tabla"></tbody>
        </table>
      </div>

      <!-- Selector y paginación -->
      <div style="margin-top:8px;text-align:center">
        <label for="page-size">Mostrar
          <select id="page-size">
            <option>5</option>
            <option selected>10</option>
            <option>20</option>
            <option>50</option>
          </select>
          registros por página
        </label>
      </div>

      <div id="paginacion" class="pagination"></div>
    </section>

    <!-- FORMULARIO -->
    <section class="card card-form" id="card-form">
      <h3>Formulario</h3>
      <form class="form" id="cliente-form" novalidate>
        <div class="field">
          <label for="c-id">IDCliente</label>
          <input id="c-id" class="input" placeholder="(auto)" readonly />
          <small class="help">Se conserva el ID del archivo importado; si falta, se genera.</small>
        </div>

        <div class="field">
          <label for="c-nombre">Nombre</label>
          <input id="c-nombre" class="input" placeholder="Razón social o nombre comercial" autocomplete="off" required />
        </div>

        <div class="field">
          <label for="c-telefono">Teléfono</label>
          <input id="c-telefono" class="input" inputmode="numeric" autocomplete="tel" maxlength="27" data-phone-mask placeholder="4441234567 o 4441234567/4449876543" />
          <small class="help">10 dígitos o 2 teléfonos (20 dígitos) separados por “/”.</small>
        </div>

        <div class="field">
          <label for="c-direccion">Dirección</label>
          <input id="c-direccion" class="input" placeholder="Calle, #, Colonia, Ciudad" autocomplete="off" />
        </div>

        <div class="field">
          <label for="c-rfc">RFC</label>
          <input id="c-rfc" class="input" placeholder="ABC123456XYZ" autocomplete="off" pattern="[A-ZÑ&]{3,4}[0-9]{6}[A-Z0-9]{3}" title="Formato válido de RFC" />
        </div>

        <div class="field">
          <label for="c-estado">Estado</label>
          <input id="c-estado" class="input" placeholder="San Luis Potosí" autocomplete="off" />
        </div>

        <div class="field">
          <label for="c-contacto">Nombre de Contacto</label>
          <input id="c-contacto" class="input" placeholder="Persona de contacto" autocomplete="off" />
        </div>

        <div class="field">
          <label for="c-contacto-tel">Teléfono de Contacto</label>
          <input id="c-contacto-tel" class="input" inputmode="numeric" autocomplete="tel" maxlength="27" data-phone-mask placeholder="4441234567 o 4441234567/4449876543" />
          <small class="help">10 dígitos o 2 teléfonos (20 dígitos) separados por “/”.</small>
        </div>

        <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <button class="btn" id="c-guardar" type="submit">Guardar</button>
          <button class="btn ghost" id="c-nuevo" type="button">Nuevo</button>
          <button class="btn danger" id="c-eliminar" type="button">Eliminar</button>
          <span style="flex:1"></span>
          <button class="btn ghost" id="c-cerrar" type="button" title="Ocultar formulario">Cerrar</button>
        </div>
      </form>
    </section>
  </main>

  <!-- Librerías -->
  <script src="https://alcdn.msauth.net/browser/2.38.2/js/msal-browser.min.js"></script>
  <script src="./js/msal-config.js"></script>
  
  
  <script src="./config/base.config.js"></script>
  <script src="./config/files.config.js"></script>
  <script src="./js/roles.js"></script>
  <script src="./config/clientes.config.js"></script>
<script src="./js/auth.js"></script>
  <script src="./js/graph.js"></script>
  <script src="./js/data.js"></script>
  <script src="./js/clientes.js?v=11"></script>

  <!-- Contador reactivo -->
  <script>
    document.addEventListener("clientes:count", (e) => {
      const n = e.detail?.count ?? 0;
      const b = document.getElementById("c-contador");
      if (b) b.textContent = n;
    });
  </script>

  


  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try { if (window.Roles?.init) await window.Roles.init(); } catch(_){}
      const cfg = (window.ModuleConfig && window.ModuleConfig.clientes)?.ui || {};
      if (window.Roles?.disableIfBelow && cfg.editMinRole) {
        const editSelectors = ["#btn-guardar","#btn-nuevo","#o-guardar","#o-nuevo","#inv-guardar","#inv-nuevo","#cob-guardar","#cob-nuevo"];
        Roles.disableIfBelow(editSelectors, cfg.editMinRole);
      }
      if (window.Roles?.hideIfBelow && Array.isArray(cfg.adminOnlySelectors)) {
        Roles.hideIfBelow(cfg.adminOnlySelectors, "ADMIN");
      }
    });
  </script>

</body>
</html>