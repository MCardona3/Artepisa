<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Inventario · Artepisa SLP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/ordenes.css" />
  <link rel="stylesheet" href="./css/inventario.css" />
  <link rel="icon" type="image/png" sizes="32x32" href="./img/arte.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/arte.png?v=1">
</head>
<body class="theme-light">
  <!-- Guardia: volver al login si no hay sesión -->
  <script>
    const __acct = JSON.parse(sessionStorage.getItem('artepisa_account')||'null');
    if(!__acct){ location.href = 'index.html'; }
  </script>

<header class="brand">
  <div class="logo">
    <img class="brandlogo" src="./img/arte.png?v=1" alt="ARTEPISA SLP">
    <div>
      <div class="brandname">ARTEPISA SLP</div>
      <div class="muted">Módulo de Inventario (OneDrive/SharePoint)</div>
    </div>
  </div>
  <a class="btn ghost" href="dashboard.html">Volver</a>
</header>

<main class="container tablewide" id="layout">
  <!-- LISTADO -->
  <section class="card" id="card-list">
    <h1 style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <span style="flex:1">Inventario</span>
      <button class="btn ghost"  id="inv-export" type="button">Exportar</button>
      <button class="btn ghost"  id="inv-import" type="button">Importar</button>
      <button class="btn danger" id="inv-clear"  type="button">Limpiar</button>
      <button class="btn"        id="btn-show-form" type="button">Crear / Agregar</button>
    </h1>

    <!-- input de archivo oculto (para Importar) -->
    <input id="inv-file" type="file" accept=".json,.csv" hidden>

    <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
      <input id="inv-buscar" class="input" placeholder="Buscar por SKU, descripción, proveedor o ubicación" style="flex:1;min-width:260px">
    </div>

    <div class="table-wrap ot-wrap">
      <table class="table ot-table">
        <thead>
          <tr>
            <th>SKU</th>
            <th>Descripción</th>
            <th>Unidad</th>
            <th>Stock</th>
            <th>Mín.</th>
            <th>Ubicación</th>
            <th>Proveedor</th>
            <th>Estado</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="inv-tabla"></tbody>
      </table>
    </div>

    <p>Total ítems: <strong id="inv-count">0</strong></p>
  </section>

  <!-- FORMULARIO -->
  <section class="card card-form" id="card-form" style="display:none">
    <h2>Formulario de Inventario</h2>
    <div class="form" id="inv-form">
      <div class="field"><span>SKU</span><input id="f-sku" class="input" placeholder="Código interno"></div>
      <div class="field"><span>Descripción</span><input id="f-nombre" class="input" placeholder="Descripción del material / pieza"></div>
      <div class="field"><span>Categoría</span><input id="f-cat" class="input" placeholder="Ej. Aceros, Eléctrico"></div>
      <div class="field"><span>Unidad</span>
        <select id="f-un" class="input">
          <option value="pza">pza</option>
          <option value="kg">kg</option>
          <option value="m">m</option>
          <option value="jgo">jgo</option>
        </select>
      </div>
      <div class="field"><span>Stock</span><input id="f-stock" class="input" type="number" step="0.01" value="0"></div>
      <div class="field"><span>Mínimo</span><input id="f-min" class="input" type="number" step="0.01" value="0"></div>
      <div class="field"><span>Ubicación</span><input id="f-ubi" class="input" placeholder="Rack / pasillo / caja"></div>
      <div class="field"><span>Proveedor</span><input id="f-prov" class="input" list="dl-proveedores" placeholder="Proveedor" /><datalist id="dl-proveedores"></datalist></div>
      <div class="field"><span>Costo</span><input id="f-costo" class="input" type="number" step="0.01" placeholder="0.00"></div>
      <div class="field"><span>Material de cliente</span>
        <label style="display:flex;gap:8px;align-items:center">
          <input id="f-escliente" type="checkbox"> <span class="muted">Sí, pertenece a cliente</span>
        </label>
      </div>
      <div class="field"><span>OT asociada</span><input id="f-ot" class="input" placeholder="No. OT (si aplica)"></div>
      <div class="field" style="grid-column:1 / -1"><span>Notas</span><input id="f-notas" class="input" placeholder="Observaciones"></div>

      <div class="items-box">
        <div class="items-head" style="display:grid;grid-template-columns: 1fr 140px 120px 90px;gap:8px;align-items:center;font-weight:600;margin-bottom:6px">
          <div>Lote / Serie</div><div>Caduca</div><div>Cantidad</div><div></div>
        </div>
        <div id="lotes-container"></div>
        <button class="btn icon" id="btn-add-lote" type="button">➕ Agregar lote</button>
      </div>

      <div class="actions" style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <button class="btn" id="inv-guardar" type="button">Guardar</button>
        <button class="btn ghost" id="inv-nuevo" type="button">Nuevo</button>
        <span style="flex:1"></span>
        <button class="btn ghost" id="inv-cerrar" type="button">Cerrar</button>
      </div>
    </div>
  </section>
</main>

<!-- Scripts -->
<script src="./js/msal-config.js"></script>
<script src="https://alcdn.msauth.net/browser/2.38.2/js/msal-browser.min.js"></script>
<script src="./js/auth.js"></script>
<script type="module" src="./js/inv-graph.js"></script>
</body>
</html>
